<!DOCTYPE html>
<html>
<head>
<script src="scripts.js"></script>

<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Форма ввода</title>
<link href="styles_fl.css" rel="stylesheet" type="text/css"/>
<style>
    .error {
      border: 2px solid red;
    }
</style>
<!-- Include flatpickr CSS -->
<link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet"/>
</head>
<body>
<form data-content-type="web_app_data" enctype="multipart/form-data">

        <label for="f_fl">Фамилия:</label>
        <input type="text" id="f_fl" name="f_fl" required pattern="[а-яА-ЯёЁa-zA-Z]+" placeholder="Введите фамилию">
        <br>

        <label for="i_fl">Имя:</label>
        <input type="text" id="i_fl" name="i_fl" required pattern="[а-яА-ЯёЁa-zA-Z]+" placeholder="Введите имя">
        <br>

        <label for="o_fl">Отчество:</label>
        <input type="text" id="o_fl" name="o_fl" required pattern="[а-яА-ЯёЁa-zA-Z]+" placeholder="Введите отчество">
        <br>

        <label for="city_fl">Город:</label>
        <input type="text" id="city_fl" name="city_fl" required pattern="[а-яА-ЯёЁa-zA-Z]+" placeholder="Введите город">
        <br>

        <label for="street_fl">Улица:</label>
        <input type="text" id="street_fl" name="street_fl" required placeholder="Введите улицу">
        <br>


        <label for="house_fl">Номер дома:</label>
        <input type="text" id="house_fl" name="room_fl" required pattern="[0-9а-яА-Яa-zA-Z]+" placeholder="Введите номер дома">
        <br>



        <label for="room_fl">Номер квартиры:</label>
        <input type="text" id="room_fl" name="room_fl" required pattern="[0-9]+" placeholder="Если есть" value="0">
        <br>


        <label for="post_index_fl">Почтовый индекс:</label>
        <input type="text" id="post_index_fl" name="post_index_fl" required pattern="[0-9]{6}" placeholder="6 цифр">
        <br>

        <label for="phone_fl">Телефон:</label>
        <input type="text" id="phone_fl" name="phone_fl" required pattern="\+7[0-9]{10}" placeholder="Введите телефон в формате +7XXXXXXXXXX" value="+7">
        <br>

        <label for="email_fl">Email:</label>
        <input type="text" id="email_fl" name="email_fl" required pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}" placeholder="Введите email">
        <br>

        <label for="pasport_serial_fl">Серия паспорта:</label>
        <input type="text" id="pasport_serial_fl" name="pasport_serial_fl" required pattern="[0-9]{4}" placeholder="4 цифры">
        <br>

        <label for="pasport_number_fl">Номер паспорта:</label>
        <input type="text" id="pasport_number_fl" name="pasport_number_fl" required pattern="[0-9]{6}" placeholder="6 цифр">
        <br>

        <label for="pasport_vudan_fl">Кем выдан:</label>
        <input type="text" id="pasport_vudan_fl" name="pasport_vudan_fl" placeholder="Кем выдан?">
        <br>

        <label for="pasport_vudan_data_fl">Дата выдачи паспорта (дд.мм.гггг):</label>
        <input type="text" id="pasport_vudan_data_fl" name="pasport_vudan_data_fl" placeholder="Введите дату в формате дд.мм.гггг">
        <br>

        <label for="inn_fl">ИНН:</label>
        <input type="text" id="inn_fl" name="inn_fl" required pattern="[0-9]{12}" placeholder="12 цифр">
        <br>


        <label for="snils_fl">СНИЛС:</label>
        <input type="text" id="snils_fl" name="snils_fl" required pattern="[0-9]{3}-[0-9]{3}-[0-9]{3} [0-9]{2}" placeholder="11 цифр">
        <br>

        <label for="bank_fl">Название банка:</label>
        <input type="text" id="bank_fl" name="bank_fl" required pattern="[0-9а-яА-Яa-zA-Z]+" placeholder="Введите название банка">
        <br>

        <label for="rs_fl">Расчетный счет:</label>
        <input type="text" id="rs_fl" name="rs_fl" required pattern="408[0-9]{17}" placeholder="Введите расчетный счет (20 цифр)" value="408">
        <br>

        <label for="ks_fl">Корреспондентский счет:</label>
        <input type="text" id="ks_fl" name="ks_fl" required pattern="30101[0-9]{15}" placeholder="20 цифр начиная с 30101" value="30101">
        <br>


        <label for="bik_fl">БИК:</label>
<input type="text" id="bik_fl" name="bik_fl" required pattern="04[0-9]{7}" placeholder="9 цифр" value="04">
<br>



        <button id="submit" type="submit">Создать заявку</button>
        <button type="button" id="cancel-button">Отмена</button>

    </form>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ru.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  let tg = window.Telegram.WebApp;

  // Получение кнопки отправки формы
  let submitButton = document.getElementById("submit");
  let form = document.querySelector("form"); // Добавьте селектор вашей формы, если у нее нет id

  submitButton.addEventListener("click", function (event) {
    event.preventDefault(); // Предотвратите стандартное поведение формы

    // Проверяем, валидна ли форма
    if (form.checkValidity()) {
      // Собираем данные из полей формы
      let data = {
          action: "register", // Добавляем поле action
        f_fl: document.getElementById("f_fl").value,
        i_fl: document.getElementById("i_fl").value,
        o_fl: document.getElementById("o_fl").value,
        city_fl: document.getElementById("city_fl").value,
        street_fl: document.getElementById("street_fl").value,
        house_fl: document.getElementById("house_fl").value,
        room_fl: document.getElementById("room_fl").value,
        post_index_fl: document.getElementById("post_index_fl").value,
        phone_fl: document.getElementById("phone_fl").value,
        email_fl: document.getElementById("email_fl").value,
        pasport_serial_fl: document.getElementById("pasport_serial_fl").value,
        pasport_number_fl: document.getElementById("pasport_number_fl").value,
        pasport_vudan_fl: document.getElementById("pasport_vudan_fl").value,
        pasport_vudan_data_fl: document.getElementById("pasport_vudan_data_fl").value,
        inn_fl: document.getElementById("inn_fl").value,
        snils_fl: document.getElementById("snils_fl").value,
        bank_fl: document.getElementById("bank_fl").value,
        rs_fl: document.getElementById("rs_fl").value,
        ks_fl: document.getElementById("ks_fl").value,
        bik_fl: document.getElementById("bik_fl").value,
      };

      // Отправляем данные в телеграм-бота
      tg.sendData(JSON.stringify(data));

      // Закрываем окно
      tg.close();
    } else {
      // Если форма невалидна, показываем ошибки
      form.reportValidity();
    }
  });
});

</script>














<script>
function restrictInput(inputElement, pattern, format) {
  inputElement.addEventListener("input", function () {
    var inputValue = this.value;

    // Применяем регулярное выражение для ограничения ввода
    var cleanedValue = inputValue.replace(pattern, '');

    // Форматируем значение согласно заданному формату
    var formattedValue = format(cleanedValue);

    this.value = formattedValue;
  });
}

// Форматирование ИНН (ограничение в 12 символов)
restrictInput(document.getElementById("inn_fl"), /[^\d]/g, function (cleanedValue) {
  return cleanedValue.slice(0, 12);
});

// Форматирование СНИЛС (добавление дефисов)
restrictInput(document.getElementById("snils_fl"), /[^\d]/g, function (cleanedValue) {
  var value = cleanedValue.slice(0, 11);
  return value.slice(0, 3) + "-" + value.slice(3, 6) + "-" + value.slice(6, 9) + " " + value.slice(9, 11);
});

// Форматирование почтового индекса (ограничение в 6 символов)
restrictInput(document.getElementById("post_index_fl"), /[^\d]/g, function (cleanedValue) {
  return cleanedValue.slice(0, 6);
});


// Форматирование номера квартиры (оставляем буквы и цифры)
restrictInput(document.getElementById("room_fl"), /[^a-zA-Z\d]/g, function (cleanedValue) {
  return cleanedValue;
});

// Форматирование телефона (добавление "+7" и ограничение в 12 символов)
restrictInput(document.getElementById("phone_fl"), /[^\d\+]/g, function (cleanedValue) {
  if (!cleanedValue.startsWith("+7")) {
    cleanedValue = "+7" + cleanedValue;
  }
  return cleanedValue.slice(0, 12);
});

// Форматирование серии паспорта (ограничение в 4 символа)
restrictInput(document.getElementById("pasport_serial_fl"), /[^\d]/g, function (cleanedValue) {
  return cleanedValue.slice(0, 4);
});

// Форматирование номера паспорта (ограничение в 6 символов)
restrictInput(document.getElementById("pasport_number_fl"), /[^\d]/g, function (cleanedValue) {
  return cleanedValue.slice(0, 6);
});

// Форматирование расчетного счета (добавление "408" и ограничение в 20 символов)
restrictInput(document.getElementById("rs_fl"), /[^\d]/g, function (cleanedValue) {
  if (!cleanedValue.startsWith("408")) {
    cleanedValue = "408" + cleanedValue;
  }
  return cleanedValue.slice(0, 20);
});

// Форматирование корреспондентского счета (добавление "30101" и ограничение в 20 символов)
restrictInput(document.getElementById("ks_fl"), /[^\d]/g, function (cleanedValue) {
  if (!cleanedValue.startsWith("30101")) {
    cleanedValue = "30101" + cleanedValue;
  }
  return cleanedValue.slice(0, 20);
});

// Форматирование БИК (добавление "04" и ограничение в 9 символов)
restrictInput(document.getElementById("bik_fl"), /[^\d]/g, function (cleanedValue) {
  if (!cleanedValue.startsWith("04")) {
    cleanedValue = "04" + cleanedValue;
  }
  return cleanedValue.slice(0, 9);
});

// Форматирование даты (добавление точек и ограничение в "дд.мм.гггг")
restrictInput(document.getElementById("pasport_vudan_data_fl"), /[^\d]/g, function (cleanedValue) {
  cleanedValue = cleanedValue.slice(0, 8);
  if (cleanedValue.length >= 2) {
    cleanedValue = cleanedValue.slice(0, 2) + '.' + cleanedValue.slice(2);
  }
  if (cleanedValue.length >= 5) {
    cleanedValue = cleanedValue.slice(0, 5) + '.' + cleanedValue.slice(5);
  }
  return cleanedValue;
});



var emailInput = document.getElementById("email_fl");

emailInput.addEventListener("input", function () {
  var inputValue = this.value;

  // Проверяем, содержит ли введенное значение русские буквы
  var hasRussianLetters = /[а-яА-ЯёЁ]/.test(inputValue);

  if (hasRussianLetters) {
    // Если есть русские буквы, очищаем поле
    this.value = this.value.replace(/[а-яА-ЯёЁ]/g, '');
  }
});

</script>
</body>
</html>
